(function(e,t,n){var r="An unexpected error has occurred. Please try again.",i="focus",s="blur",o="keyup",u="scroll",a="resize",f="submit",l="reset",c="click",h="selectstart touchstart",p=c+" "+h,d=1,v=2,m=3,g=4,y=5,b=6,w=7,E=8,S=9,x,T,N,C,k,L,A,O,M;x=function(e,t,n,r){var i;return function(){var s=this,o=arguments,u=function(){i=null,n||e.apply(s,o)},a=n&&!i;clearTimeout(i),i=setTimeout(u,t),a?e.apply(s,o):r&&r.call(i,t)}},T=function(e,t,n,r){t||(t=250);var i,s;return function(){var o=n||this,u=+(new Date),a=arguments;i&&u<i+t?(r&&r.call(o,s,t),clearTimeout(s),s=setTimeout(function(){i=u,e.apply(o,a)},t)):(i=u,e.apply(o,a))}},N=function(){function t(t,n){e.push([t,n||this])}var e=[];return t.fire=function(){return e.forEach(function(e){return e[0].call(e[1])})},t}(),C=function(e,t,n){if(!n&&n!==0||n.toString().length!=1)n=" ";e=e.toString();var r=e.length+1,i="";while(r++<=t)i+=n;return i+e},k=function(e,t){var n=typeof e=="string"&&e.match(/^(\d+)-(\d+)-(\d+)$/),r;if(!n||n.length!=4)return t;var i=parseInt(n[1]),s=parseInt(n[2])-1,o=parseInt(n[3]);return s<0||s>11||o>31||o<1?t:(i<30&&(i+=2e3),r=new Date(i,s,o),isNaN(r.getTime())?t:r)},L=function(e){var t=new Date(e);return t?[t.getFullYear().toString(),C(t.getMonth()+1,2,0),C(t.getDate(),2,0)].join("-"):""},A=function(){function c(){i.attr("disabled",!1).val("Save"),s.attr("disabled",!1),o.html("")}function h(e,t){i.attr("disabled",!0).val(e||"Saved"),s.attr("disabled",!0),o.removeClass("error").html(""),u[t=="on"?"addClass":"removeClass"]("on")}function p(e,n){var r=new FormData;r.append("img",e),t.ajax({url:"/admin/upload",data:r,processData:!1,contentType:!1,type:"POST"}).done(function(r,i,s){if(!n)for(var o=1;o<=3;o++)if(!t('input[name="img'+o+'"]').val()){n=o;break}var u=t('input[name="img'+n+'"]'),f=u.closest("fieldset"),l=f.find("img");f.removeClass("empty"),l.attr("src",r.url),u.val(r.md5),a[0].reset()}).fail(function(e,t,n){console.log("FAIL",e,t,n)})}function d(){}function v(e,t){}function m(e){Prize.data["img"+e]=null}function g(){}var e="/img/unavailable.png",n="Server error encountered. Please try again.",r,i,s,o,u,a,f,l;return N(function(){r=t("form.prize"),i=r.find('input[type="submit"]'),s=r.find('input[type="reset"]'),o=r.find(".msg"),u=r.find(".loader"),a=t("form.upload"),f=a.find('input[type="file"]'),l=r.find("fieldset.img"),A.id=parseInt(r.find('input[name="id"]').val()),isNaN(A.id)&&(A.id=0),r.find("input, select, textarea").on("change, keydown",c),r.on("reset",function(){return h("No Changes"),!0}),r.on("submit",function(e){function i(e,t,n){return h(),e.status!==1?s(e.message):(e.prize_id&&(A.id=parseInt(e.prize_id,10),r.find('input[name="id"]').val(A.id),window.location.href=window.location.href.replace(/0$/,A.id)),!1)}function s(e){return h(),c(),o.addClass("error").html(e||n),!1}return h("Savingâ€¦","on"),t.ajax({url:"/admin/prize",data:t(this).serialize(),type:"POST"}).done(i).fail(function(){console.log(arguments),s()}),!1}),f.on("change",function(e){c(),p(this.files[0],f.data("index"))}),r.on("click","fieldset.img img",function(e){e.stopPropagation(),e.preventDefault();var n=t(this).closest("fieldset"),r=n.find('input[type="hidden"]').attr("name").substring(3);f.data("index",r),f.trigger("click")}),r.on("click","fieldset.img b",function(n){c(),n.stopPropagation(),n.preventDefault();var r=t(this).closest("fieldset"),i=r.find("img"),s=r.find('input[type="hidden"]');r.addClass("empty"),i.attr("src",e),s.val("")}),t(document).bind("dragover",function(e){e.preventDefault();var n,r=window.dropZoneTimeout;r?clearTimeout(r):l.addClass("in");var i=!1,s=e.target;do{if(t(s).hasClass("img")){i=!0,n=t(s);break}s=s.parentNode}while(s!==null);l.removeClass("in hover"),i&&n.addClass("hover"),window.dropZoneTimeout=setTimeout(function(){window.dropZoneTimeout=null,l.removeClass("in hover")},100)}).bind("drop",function(e){c(),e.stopPropagation(),e.preventDefault();var n=t(e.target).closest("fieldset.img").find('input[type="hidden"]').attr("name"),r=n&&n.substring(3);return p((e.originalEvent.target.files||e.originalEvent.dataTransfer.files)[0],r),!1})}),{id:null}}(),O=function(){function a(e){s.html(e||r),i.addClass("error")}function f(e,n,r){if(!A.id)return a("Please save this prize before adding flight dates."),!1;s.html(""),i.removeClass("error"),t.ajax({url:"/admin/contest/"+e,data:{prize_id:A.id,date:n},dataType:"json",type:"POST"}).done(function(n,i,s){n.status===1?t.type(r)=="function"&&r(n):a(n.message)}).fail(function(e,t,n){a()})}function l(){var n=[];return e.find("tr").each(function(e,r){var i=t(r).find("td:nth-child(2)").text();i.match(/\d+-\d+\d+/)&&n.push(i)}),n.last=function(){return this[this.length-1]},n}function c(t){var n=o.indexOf(t)+2;e.find("tr:nth-child("+n+")").addClass("highlight")}function h(r){f("add",r,function(i){o.push(r),o.sort();var s=o.indexOf(r)+1;e.find("tr:nth-child("+s+")").after(t('<tr class="future"><td><b></b></td><td>'+r+"</td><td></td><td></td></tr>").addClass(r==u?"highlight":"")),n.val("")})}function p(t){f("del",t,function(n){var r=o.indexOf(t),i=r+2;o.splice(r,1),e.find("tr:nth-child("+i+")").remove()})}function d(t){n.val(""),f("alt",t,function(n){var r=o.indexOf(t),i=r+2,s=e.find("tr:nth-child("+i+")"),u=s.find("td:nth-child(3)"),a=s.find("td:nth-child(4)"),f=n.winner;u.html('<a href="mailto:'+f.email+'">'+f.firstname+" "+f.lastname+"</a>"),a.html(f.city+", "+f.state)})}var e,n,i,s,o,u=location.hash.substr(1)||k(new Date);N(function(){e=t("#flight"),n=t("#add_flight"),i=e.find("tr:last-child"),s=t("#contest_error"),o=l(),u=location.hash.substr(1)||k(new Date),c(u),n.on("keydown",function(e){switch(e.which){case 38:case 40:var n=(k(t(this).val())||k(o.last(),new Date)).getTime();return e.which==40?n+=864e5:n-=864e5,t(this).val(L(n)),!0;case 9:break;case 13:e.preventDefault();break;default:return!0}var r=t(this).val();if(k(r)<=new Date)return a("Cannot add a date in the past"),!1;if(o.indexOf(r)>=0)return a("This prize is already scheduled for "+r+"."),!1;h(r)}),e.on("click","b",function(){var e=t(this).closest("tr"),n=e.find("td:nth-child(2)").text(),r=!e.hasClass("won");r?p(n):d(n)})})}(),M=function(e){function n(){var e=[],r;return arguments.length?(Array.prototype.push.apply(e,arguments),r=e.shift(),r&&r in n&&t.isFunction(n[r])?n[r].apply(this,e):!1):!1}return n}(x);var _,D=0;(function P(){if(!e[t]){D++||(_=setInterval(P,16));return}_&&clearInterval(_),t=e[t],e[n]&&e[n].q&&e[n].q.forEach(function(t){M.apply(e,t)}),e[n]=M,t(N.fire)})()})(window,"jQuery","admin");